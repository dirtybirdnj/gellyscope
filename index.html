<!DOCTYPE html>
<!-- index.html - v41 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🪼 Gellyscope 🌸</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Tab Navigation -->
    <div class="tab-nav">
      <button class="tab-button" data-tab="camera">Camera</button>
      <button class="tab-button" data-tab="images">Images</button>
      <button class="tab-button" data-tab="vectors">Vectors</button>
      <button class="tab-button" data-tab="trace">Trace</button>
      <button class="tab-button" data-tab="eject">Eject</button>
      <button class="tab-button active" data-tab="scope">Scope</button>
    </div>

    <!-- Camera Tab -->
    <div class="tab-content" id="cameraTab">
      <div class="camera-container">
        <div class="camera-preview" id="cameraPreview">
          <video id="cameraVideo" autoplay playsinline></video>
          <canvas id="captureCanvas" style="display: none;"></canvas>
          <div class="camera-message" id="cameraMessage">Click "Start Camera" to begin</div>
        </div>
        <div class="camera-controls">
          <button class="control-btn" id="startCamera">Start Camera</button>
          <button class="control-btn" id="capturePhoto" disabled>Capture Photo</button>
          <button class="control-btn" id="stopCamera" disabled>Stop Camera</button>
        </div>
      </div>
    </div>

    <!-- Images Tab -->
    <div class="tab-content" id="imagesTab">
      <div class="images-container">
        <div class="image-grid" id="imageGrid">
          <!-- Jellyfish placeholders -->
        </div>
      </div>
    </div>

    <!-- Vectors Tab -->
    <div class="tab-content" id="vectorsTab">
      <div class="vectors-container">
        <div class="vector-grid" id="vectorGrid">
          <!-- Vector files will appear here -->
        </div>
      </div>
    </div>

    <!-- Trace Tab -->
    <div class="tab-content" id="traceTab">
      <div class="container">
        <!-- Left Panel: Layers -->
        <div class="left-panel">
          <div class="panel-header">Layers</div>
          <div class="layers-list" id="traceLayersList">
            <div style="padding: 16px; text-align: center; opacity: 0.5; font-size: 13px;">
              No layers
            </div>
          </div>
        </div>

        <!-- Center: Image Viewer -->
        <div class="canvas-area">
          <div class="trace-viewer" id="traceViewer">
            <div class="trace-message" id="traceMessage">
              Select an image from the Images tab to trace it
            </div>
            <div class="trace-image-container" id="traceImageContainer" style="display: none;">
              <img id="traceImage" class="trace-bitmap">
              <div id="traceSvgOverlay" class="trace-svg-overlay"></div>
            </div>
          </div>

          <!-- Output Toolbar -->
          <div class="output-toolbar" id="outputToolbar" style="display: none;">
            <div class="toolbar-section">
              <label class="toolbar-label">Output Scale</label>
              <input type="range" class="output-scale-slider" id="outputScaleSlider" min="10" max="100" value="100" step="5">
              <span class="toolbar-value" id="outputScaleValue">100%</span>

              <div class="toolbar-divider"></div>

              <label class="toolbar-label">Page Size</label>
              <div class="page-size-group">
                <button class="page-size-btn" data-size="A0">A0</button>
                <button class="page-size-btn" data-size="A1">A1</button>
                <button class="page-size-btn" data-size="A2">A2</button>
                <button class="page-size-btn" data-size="A3">A3</button>
                <button class="page-size-btn active" data-size="A4">A4</button>
                <button class="page-size-btn" data-size="A5">A5</button>
                <button class="page-size-btn" data-size="A6">A6</button>
                <button class="page-size-btn" data-size="A7">A7</button>
                <button class="page-size-btn" data-size="custom">Custom</button>
              </div>
              <div class="custom-size-inputs" id="customSizeInputs" style="display: none;">
                <input type="number" class="custom-input" id="customWidth" placeholder="Width" min="1" step="0.1">
                <span class="custom-separator">×</span>
                <input type="number" class="custom-input" id="customHeight" placeholder="Height" min="1" step="0.1">
                <select class="custom-unit" id="customUnit">
                  <option value="mm">mm</option>
                  <option value="cm">cm</option>
                  <option value="in">inches</option>
                </select>
              </div>
            </div>

            <div class="toolbar-section">
              <button class="toolbar-action-btn save-svg-btn" id="saveSvgBtn">
                <span>💾</span> Save SVG
              </button>
              <button class="toolbar-action-btn save-image-btn" id="saveImageBtn">
                <span>📷</span> Save Image
              </button>
            </div>
          </div>
        </div>

        <!-- Right Panel: Controls -->
        <div class="right-panel">
          <div class="panel-header">Processing Pipeline</div>
          <div class="trace-controls" id="traceControls">

            <!-- Image Scaling Section -->
            <div class="pipeline-section">
              <div class="section-header" data-section="image-scaling">
                <span class="section-collapse-arrow">▼</span>
                <span>Image Scaling</span>
              </div>
              <div class="section-content" data-section-content="image-scaling">

                <div class="control-group">
                  <label class="control-label">Original Dimensions</label>
                  <div class="dimension-display" id="originalDimensions">-</div>
                </div>

                <div class="control-group">
                  <label class="control-label">Scale</label>
                  <div class="scale-btn-group">
                    <button class="scale-btn active" data-scale="100">100%</button>
                    <button class="scale-btn" data-scale="75">75%</button>
                    <button class="scale-btn" data-scale="50">50%</button>
                    <button class="scale-btn" data-scale="25">25%</button>
                  </div>
                </div>

                <div class="control-group" id="scaledDimensionsGroup" style="display: none;">
                  <label class="control-label">Scaled Dimensions</label>
                  <div class="dimension-display scaled" id="scaledDimensions">-</div>
                </div>

              </div>
            </div>

            <!-- Image Processing Section -->
            <div class="pipeline-section">
              <div class="section-header" data-section="image-processing">
                <span class="section-collapse-arrow">▼</span>
                <span>Image Processing</span>
              </div>
              <div class="section-content" data-section-content="image-processing">

              <div class="control-group">
                <label class="control-label">Brightness</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="brightnessSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="brightnessSlider" min="-100" max="100" value="0" step="1">
                  <button class="arrow-btn" data-target="brightnessSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="brightnessValue">0</span>
              </div>

              <div class="control-group">
                <label class="control-label">Contrast</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="contrastSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="contrastSlider" min="-100" max="100" value="0" step="1">
                  <button class="arrow-btn" data-target="contrastSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="contrastValue">0</span>
              </div>

              <div class="control-group">
                <label class="control-label">Saturation</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="saturationSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="saturationSlider" min="-100" max="100" value="0" step="1">
                  <button class="arrow-btn" data-target="saturationSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="saturationValue">0</span>
              </div>

              <div class="control-group">
                <label class="control-label">Hue Rotation</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="hueSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="hueSlider" min="0" max="360" value="0" step="1">
                  <button class="arrow-btn" data-target="hueSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="hueValue">0°</span>
              </div>

              <div class="control-group">
                <label class="control-label">Greyscale</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="greyscaleToggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="control-group">
                <label class="control-label">Sepia</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="sepiaToggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              </div>
            </div>

            <!-- Potrace Parameters Section -->
            <div class="pipeline-section">
              <div class="section-header" data-section="trace-parameters">
                <span class="section-collapse-arrow">▼</span>
                <span>Trace Parameters</span>
              </div>
              <div class="section-content" data-section-content="trace-parameters">

              <div class="control-group">
                <label class="control-label">Turn Policy</label>
                <select class="control-select" id="turnPolicySelect">
                  <option value="minority">Minority</option>
                  <option value="majority">Majority</option>
                  <option value="black">Black</option>
                  <option value="white">White</option>
                  <option value="left">Left</option>
                  <option value="right">Right</option>
                </select>
              </div>

              <div class="control-group">
                <label class="control-label">Turd Size</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="turdSizeSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="turdSizeSlider" min="1" max="20" value="2" step="1">
                  <button class="arrow-btn" data-target="turdSizeSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="turdSizeValue">2</span>
              </div>

              <div class="control-group">
                <label class="control-label">Alpha Max</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="alphaMaxSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="alphaMaxSlider" min="0" max="2" step="0.1" value="1">
                  <button class="arrow-btn" data-target="alphaMaxSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="alphaMaxValue">1.0</span>
              </div>

              <div class="control-group">
                <label class="control-label">Opt Tolerance</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="optToleranceSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="optToleranceSlider" min="0" max="1" step="0.05" value="0.2">
                  <button class="arrow-btn" data-target="optToleranceSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="optToleranceValue">0.20</span>
              </div>

              <div class="control-group">
                <label class="control-label">Curve Optimization</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="optCurveToggle" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              </div>
            </div>

            <!-- Path Options Section -->
            <div class="pipeline-section">
              <div class="section-header" data-section="path-options">
                <span class="section-collapse-arrow">▼</span>
                <span>Path Options</span>
              </div>
              <div class="section-content" data-section-content="path-options">

              <div class="control-group">
                <label class="control-label">Fill</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="fillToggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div id="strokeControls">
                <div class="control-group">
                  <label class="control-label">Stroke Color</label>
                  <input type="color" class="control-color" id="strokeColorPicker" value="#000000">
                </div>

                <div class="control-group">
                  <label class="control-label">Stroke Width</label>
                  <div class="control-slider-wrapper">
                    <button class="arrow-btn" data-target="strokeWidthSlider" data-direction="-1">◄</button>
                    <input type="range" class="control-slider" id="strokeWidthSlider" min="0.1" max="10" step="0.1" value="1">
                    <button class="arrow-btn" data-target="strokeWidthSlider" data-direction="1">►</button>
                  </div>
                  <span class="control-value" id="strokeWidthValue">1.0</span>
                </div>
              </div>
              </div>
            </div>

            <!-- Display Options Section -->
            <div class="pipeline-section">
              <div class="section-header" data-section="display">
                <span class="section-collapse-arrow">▼</span>
                <span>Display</span>
              </div>
              <div class="section-content" data-section-content="display">

              <div class="control-group">
                <label class="control-label">Show Bitmap</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="showBitmapToggle" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="control-group">
                <label class="control-label">Bitmap Opacity</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="bitmapOpacitySlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="bitmapOpacitySlider" min="0" max="100" value="100" step="1">
                  <button class="arrow-btn" data-target="bitmapOpacitySlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="bitmapOpacityValue">100%</span>
              </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <button class="trace-action-btn" id="traceActionBtn">Trace</button>
            <button class="trace-action-btn capture-btn" id="captureTraceBtn" disabled>Capture Trace</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Eject Tab -->
    <div class="tab-content" id="ejectTab">
      <div class="eject-container">
        <div class="eject-info-bar" id="ejectInfoBar" style="display: none;">
          <div class="eject-info-item">
            <span class="eject-info-label">Input Dimensions:</span>
            <span class="eject-info-value" id="ejectDimensions">—</span>
          </div>
          <div class="eject-info-divider"></div>
          <div class="eject-info-item">
            <span class="eject-info-label">Width:</span>
            <input type="number" class="eject-dimension-input" id="ejectFixedWidth" placeholder="Width" min="1" step="0.1">
            <span class="eject-info-label" style="margin-left: 8px;">Height:</span>
            <input type="number" class="eject-dimension-input" id="ejectFixedHeight" placeholder="Height" min="1" step="0.1">
            <select class="eject-dimension-unit" id="ejectFixedUnit">
              <option value="mm">mm</option>
              <option value="cm">cm</option>
              <option value="in" selected>inches</option>
            </select>
          </div>
          <div class="eject-info-divider"></div>
          <div class="eject-info-item">
            <label class="eject-checkbox-label">
              <input type="checkbox" id="ejectFixedOutput">
              <span>Fixed Output</span>
            </label>
          </div>
        </div>
        <div class="eject-viewer" id="ejectViewer">
          <div class="eject-message" id="ejectMessage">
            No vector image loaded
          </div>
          <div class="eject-svg-container" id="ejectSvgContainer" style="display: none;">
            <!-- SVG will be displayed here -->
          </div>
        </div>

        <!-- Output Toolbar -->
        <div class="output-toolbar" id="ejectOutputToolbar" style="display: none;">
          <div class="toolbar-section">
            <label class="toolbar-label">Page Size</label>
            <div class="page-size-group">
              <button class="page-size-btn eject-page-size-btn" data-size="A0">A0</button>
              <button class="page-size-btn eject-page-size-btn" data-size="A1">A1</button>
              <button class="page-size-btn eject-page-size-btn" data-size="A2">A2</button>
              <button class="page-size-btn eject-page-size-btn" data-size="A3">A3</button>
              <button class="page-size-btn eject-page-size-btn active" data-size="A4">A4</button>
              <button class="page-size-btn eject-page-size-btn" data-size="A5">A5</button>
              <button class="page-size-btn eject-page-size-btn" data-size="A6">A6</button>
              <button class="page-size-btn eject-page-size-btn" data-size="A7">A7</button>
              <button class="page-size-btn eject-page-size-btn" data-size="custom">Custom</button>
            </div>
            <div class="custom-size-inputs" id="ejectCustomSizeInputs" style="display: none;">
              <input type="number" class="custom-input" id="ejectCustomWidth" placeholder="Width" min="1" step="0.1">
              <span class="custom-separator">×</span>
              <input type="number" class="custom-input" id="ejectCustomHeight" placeholder="Height" min="1" step="0.1">
              <select class="custom-unit" id="ejectCustomUnit">
                <option value="mm">mm</option>
                <option value="cm">cm</option>
                <option value="in">inches</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scope Tab -->
    <div class="tab-content active" id="scopeTab">
      <div class="container">
        <!-- Left Panel: Tree Structure -->
        <div class="left-panel">
          <div class="panel-header">SVG Structure</div>
          <div class="layers-list" id="layersList">
            <div style="padding: 16px; text-align: center; opacity: 0.5; font-size: 13px;">
              No file loaded
            </div>
          </div>
        </div>

        <!-- Center: Canvas -->
        <div class="canvas-area">
          <!-- Fixed Toolbar -->
          <div class="canvas-toolbar" id="canvasToolbar">
            <!-- Edit Controls -->
            <div class="toolbar-group">
              <button class="svg-control-btn" id="cropBtn" title="Crop" style="width: auto; padding: 0 12px; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M 2 5 L 5 5 L 5 2 M 11 2 L 11 5 L 14 5 M 14 11 L 11 11 L 11 14 M 5 14 L 5 11 L 2 11" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
                <span style="font-size: 13px;">Crop</span>
              </button>
              <div class="toolbar-divider"></div>
              <button class="svg-control-btn" id="flipHorizontal" title="Flip Horizontal" style="font-size: 18px;">↔️</button>
              <button class="svg-control-btn" id="flipVertical" title="Flip Vertical" style="font-size: 18px;">↕️</button>
            </div>

            <!-- View Controls -->
            <div class="toolbar-group">
              <button class="svg-control-btn active" id="fitViewport" title="Fit to Viewport">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 5 5 L 8 8 L 11 5" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 5 11 L 8 8 L 11 11" fill="none" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
              <button class="svg-control-btn" id="fullSize" title="Full Size">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 2 2 L 5 5 M 14 2 L 11 5 M 2 14 L 5 11 M 14 14 L 11 11" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
            </div>

            <!-- Zoom Controls -->
            <div class="toolbar-group">
              <button class="svg-control-btn" id="zoomOut" title="Zoom Out">−</button>
              <div class="zoom-level" id="zoomLevel">100%</div>
              <button class="svg-control-btn" id="zoomIn" title="Zoom In">+</button>
              <button class="svg-control-btn" id="zoomReset" title="Reset Zoom">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <circle cx="8" cy="8" r="6" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 6 8 L 10 8 M 8 6 L 8 10" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="canvas-content" id="canvasContent">
            <div class="upload-zone">
              <input type="file" id="fileInput" accept=".svg" />
              <button class="upload-btn" id="uploadBtn">
                Upload SVG File
              </button>
              <div class="upload-text">
                or drag and drop an SVG file here
              </div>
            </div>
          </div>
          
          <!-- Bottom Info Bar -->
          <div class="canvas-info-bar" id="canvasInfoBar">
            <div class="info-bar-item">
              <span class="info-bar-label">Element:</span>
              <span class="info-bar-value" id="infoBarElement">—</span>
            </div>
            <div class="info-bar-divider"></div>
            <div class="info-bar-item">
              <span class="info-bar-label">X:</span>
              <span class="info-bar-value" id="infoBarX">—</span>
            </div>
            <div class="info-bar-item">
              <span class="info-bar-label">Y:</span>
              <span class="info-bar-value" id="infoBarY">—</span>
            </div>
            <div class="info-bar-divider"></div>
            <div class="info-bar-item">
              <span class="info-bar-label">Width:</span>
              <span class="info-bar-value" id="infoBarWidth">—</span>
            </div>
            <div class="info-bar-item">
              <span class="info-bar-label">Height:</span>
              <span class="info-bar-value" id="infoBarHeight">—</span>
            </div>
            <div class="info-bar-divider"></div>
            <div class="info-bar-item">
              <span class="info-bar-label">Children:</span>
              <span class="info-bar-value" id="infoBarChildren">—</span>
            </div>
          </div>
        </div>

        <!-- Right Panel: Info -->
        <div class="right-panel">
          <div class="panel-header">Element Properties</div>
          <div class="info-content" id="infoContent">
            <div style="padding: 16px; text-align: center; opacity: 0.5; font-size: 13px;">
              Select an element to view properties
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="potrace.js"></script>
  <script src="renderer.js"></script>
</body>
</html>
<!DOCTYPE html>
<!-- index.html - v38 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ü™º Gellyscope üå∏</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Tab Navigation -->
    <div class="tab-nav">
      <button class="tab-button" data-tab="camera">Camera</button>
      <button class="tab-button" data-tab="photos">Photos</button>
      <button class="tab-button active" data-tab="trace">Scope</button>
      <button class="tab-button" data-tab="plotter">Plotter</button>
    </div>

    <!-- Camera Tab -->
    <div class="tab-content" id="cameraTab">
      <div class="camera-container">
        <div class="camera-preview" id="cameraPreview">
          Camera Preview - Not Configured
        </div>
        <div class="camera-controls">
          <button class="control-btn" id="startCamera" disabled>Start Camera</button>
          <button class="control-btn" id="capturePhoto" disabled>Capture Photo</button>
          <button class="control-btn" id="stopCamera" disabled>Stop Camera</button>
        </div>
      </div>
    </div>

    <!-- Photos Tab -->
    <div class="tab-content" id="photosTab">
      <div class="photos-container">
        <div class="photo-grid" id="photoGrid">
          <!-- Jellyfish placeholders -->
        </div>
      </div>
    </div>

    <!-- Scope Tab -->
    <div class="tab-content active" id="traceTab">
      <div class="container">
        <!-- Left Panel: Tree Structure -->
        <div class="left-panel">
          <div class="panel-header">SVG Structure</div>
          <div class="layers-list" id="layersList">
            <div style="padding: 16px; text-align: center; opacity: 0.5; font-size: 13px;">
              No file loaded
            </div>
          </div>
        </div>

        <!-- Center: Canvas -->
        <div class="canvas-area">
          <!-- Fixed Toolbar -->
          <div class="canvas-toolbar" id="canvasToolbar">
            <!-- Edit Controls -->
            <div class="toolbar-group">
              <button class="svg-control-btn" id="cropBtn" title="Crop" style="width: auto; padding: 0 12px; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M 2 5 L 5 5 L 5 2 M 11 2 L 11 5 L 14 5 M 14 11 L 11 11 L 11 14 M 5 14 L 5 11 L 2 11" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
                <span style="font-size: 13px;">Crop</span>
              </button>
              <div class="toolbar-divider"></div>
              <button class="svg-control-btn" id="flipHorizontal" title="Flip Horizontal" style="font-size: 18px;">‚ÜîÔ∏è</button>
              <button class="svg-control-btn" id="flipVertical" title="Flip Vertical" style="font-size: 18px;">‚ÜïÔ∏è</button>
            </div>

            <!-- View Controls -->
            <div class="toolbar-group">
              <button class="svg-control-btn active" id="fitViewport" title="Fit to Viewport">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 5 5 L 8 8 L 11 5" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 5 11 L 8 8 L 11 11" fill="none" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
              <button class="svg-control-btn" id="fullSize" title="Full Size">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 2 2 L 5 5 M 14 2 L 11 5 M 2 14 L 5 11 M 14 14 L 11 11" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
            </div>

            <!-- Zoom Controls -->
            <div class="toolbar-group">
              <button class="svg-control-btn" id="zoomOut" title="Zoom Out">‚àí</button>
              <div class="zoom-level" id="zoomLevel">100%</div>
              <button class="svg-control-btn" id="zoomIn" title="Zoom In">+</button>
              <button class="svg-control-btn" id="zoomReset" title="Reset Zoom">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <circle cx="8" cy="8" r="6" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 6 8 L 10 8 M 8 6 L 8 10" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="canvas-content" id="canvasContent">
            <div class="upload-zone">
              <input type="file" id="fileInput" accept=".svg" />
              <button class="upload-btn" id="uploadBtn">
                Upload SVG File
              </button>
              <div class="upload-text">
                or drag and drop an SVG file here
              </div>
            </div>
          </div>
          
          <!-- Bottom Info Bar -->
          <div class="canvas-info-bar" id="canvasInfoBar">
            <div class="info-bar-item">
              <span class="info-bar-label">Element:</span>
              <span class="info-bar-value" id="infoBarElement">‚Äî</span>
            </div>
            <div class="info-bar-divider"></div>
            <div class="info-bar-item">
              <span class="info-bar-label">X:</span>
              <span class="info-bar-value" id="infoBarX">‚Äî</span>
            </div>
            <div class="info-bar-item">
              <span class="info-bar-label">Y:</span>
              <span class="info-bar-value" id="infoBarY">‚Äî</span>
            </div>
            <div class="info-bar-divider"></div>
            <div class="info-bar-item">
              <span class="info-bar-label">Width:</span>
              <span class="info-bar-value" id="infoBarWidth">‚Äî</span>
            </div>
            <div class="info-bar-item">
              <span class="info-bar-label">Height:</span>
              <span class="info-bar-value" id="infoBarHeight">‚Äî</span>
            </div>
            <div class="info-bar-divider"></div>
            <div class="info-bar-item">
              <span class="info-bar-label">Children:</span>
              <span class="info-bar-value" id="infoBarChildren">‚Äî</span>
            </div>
          </div>
        </div>

        <!-- Right Panel: Info -->
        <div class="right-panel">
          <div class="panel-header">Element Properties</div>
          <div class="info-content" id="infoContent">
            <div style="padding: 16px; text-align: center; opacity: 0.5; font-size: 13px;">
              Select an element to view properties
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Plotter Tab -->
    <div class="tab-content" id="plotterTab">
      <div class="plotter-container">
        <div class="plotter-header">
          <div class="connection-status">
            <div class="status-indicator" id="statusIndicator"></div>
            <span id="statusText">Disconnected</span>
          </div>

          <div class="serial-config">
            <div class="config-group">
              <label class="config-label">Port</label>
              <select class="config-select" id="portSelect">
                <option value="">Select Port...</option>
              </select>
            </div>
            <div class="config-group">
              <label class="config-label">Baud Rate</label>
              <select class="config-select" id="baudRate">
                <option value="9600">9600</option>
                <option value="19200">19200</option>
                <option value="38400">38400</option>
                <option value="57600">57600</option>
                <option value="115200" selected>115200</option>
              </select>
            </div>
            <div class="config-group">
              <label class="config-label">Data Bits</label>
              <select class="config-select" id="dataBits">
                <option value="7">7</option>
                <option value="8" selected>8</option>
              </select
<!DOCTYPE html>
<!-- index.html - v41 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🪼 Gellyscope 🌸</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Tab Navigation -->
    <div class="tab-nav">
      <button class="tab-button" data-tab="camera">Camera</button>
      <button class="tab-button" data-tab="images">Images</button>
      <button class="tab-button" data-tab="vectors">Vectors</button>
      <button class="tab-button" data-tab="trace">Trace</button>
      <button class="tab-button active" data-tab="scope">Scope</button>
    </div>

    <!-- Camera Tab -->
    <div class="tab-content" id="cameraTab">
      <div class="camera-container">
        <div class="camera-preview" id="cameraPreview">
          <video id="cameraVideo" autoplay playsinline></video>
          <canvas id="captureCanvas" style="display: none;"></canvas>
          <div class="camera-message" id="cameraMessage">Click "Start Camera" to begin</div>
        </div>
        <div class="camera-controls">
          <button class="control-btn" id="startCamera">Start Camera</button>
          <button class="control-btn" id="capturePhoto" disabled>Capture Photo</button>
          <button class="control-btn" id="stopCamera" disabled>Stop Camera</button>
        </div>
      </div>
    </div>

    <!-- Images Tab -->
    <div class="tab-content" id="imagesTab">
      <div class="images-container">
        <div class="image-grid" id="imageGrid">
          <!-- Jellyfish placeholders -->
        </div>
      </div>
    </div>

    <!-- Vectors Tab -->
    <div class="tab-content" id="vectorsTab">
      <div class="vectors-container">
        <div class="vector-grid" id="vectorGrid">
          <!-- Vector files will appear here -->
        </div>
      </div>
    </div>

    <!-- Trace Tab -->
    <div class="tab-content" id="traceTab">
      <div class="container">
        <!-- Left Panel: Layers -->
        <div class="left-panel">
          <div class="panel-header">Layers</div>
          <div class="layers-list" id="traceLayersList">
            <div style="padding: 16px; text-align: center; opacity: 0.5; font-size: 13px;">
              No layers
            </div>
          </div>
        </div>

        <!-- Center: Image Viewer -->
        <div class="canvas-area">
          <div class="trace-viewer" id="traceViewer">
            <div class="trace-message" id="traceMessage">
              Select an image from the Images tab to trace it
            </div>
            <div class="trace-image-container" id="traceImageContainer" style="display: none;">
              <img id="traceImage" class="trace-bitmap">
              <div id="traceSvgOverlay" class="trace-svg-overlay"></div>
            </div>
          </div>
        </div>

        <!-- Right Panel: Controls -->
        <div class="right-panel">
          <div class="panel-header">Processing Pipeline</div>
          <div class="trace-controls" id="traceControls">

            <!-- Image Processing Section -->
            <div class="pipeline-section">
              <div class="section-header">Image Processing</div>

              <div class="control-group">
                <label class="control-label">Brightness</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="brightnessSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="brightnessSlider" min="-100" max="100" value="0" step="1">
                  <button class="arrow-btn" data-target="brightnessSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="brightnessValue">0</span>
              </div>

              <div class="control-group">
                <label class="control-label">Contrast</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="contrastSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="contrastSlider" min="-100" max="100" value="0" step="1">
                  <button class="arrow-btn" data-target="contrastSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="contrastValue">0</span>
              </div>

              <div class="control-group">
                <label class="control-label">Saturation</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="saturationSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="saturationSlider" min="-100" max="100" value="0" step="1">
                  <button class="arrow-btn" data-target="saturationSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="saturationValue">0</span>
              </div>

              <div class="control-group">
                <label class="control-label">Hue Rotation</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="hueSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="hueSlider" min="0" max="360" value="0" step="1">
                  <button class="arrow-btn" data-target="hueSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="hueValue">0°</span>
              </div>

              <div class="control-group">
                <label class="control-label">Greyscale</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="greyscaleToggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="control-group">
                <label class="control-label">Sepia</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="sepiaToggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <!-- Potrace Parameters Section -->
            <div class="pipeline-section">
              <div class="section-header">Trace Parameters</div>

              <div class="control-group">
                <label class="control-label">Turn Policy</label>
                <select class="control-select" id="turnPolicySelect">
                  <option value="minority">Minority</option>
                  <option value="majority">Majority</option>
                  <option value="black">Black</option>
                  <option value="white">White</option>
                  <option value="left">Left</option>
                  <option value="right">Right</option>
                </select>
              </div>

              <div class="control-group">
                <label class="control-label">Turd Size</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="turdSizeSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="turdSizeSlider" min="1" max="20" value="2" step="1">
                  <button class="arrow-btn" data-target="turdSizeSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="turdSizeValue">2</span>
              </div>

              <div class="control-group">
                <label class="control-label">Alpha Max</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="alphaMaxSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="alphaMaxSlider" min="0" max="2" step="0.1" value="1">
                  <button class="arrow-btn" data-target="alphaMaxSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="alphaMaxValue">1.0</span>
              </div>

              <div class="control-group">
                <label class="control-label">Opt Tolerance</label>
                <div class="control-slider-wrapper">
                  <button class="arrow-btn" data-target="optToleranceSlider" data-direction="-1">◄</button>
                  <input type="range" class="control-slider" id="optToleranceSlider" min="0" max="1" step="0.05" value="0.2">
                  <button class="arrow-btn" data-target="optToleranceSlider" data-direction="1">►</button>
                </div>
                <span class="control-value" id="optToleranceValue">0.20</span>
              </div>

              <div class="control-group">
                <label class="control-label">Curve Optimization</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="optCurveToggle" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <!-- Path Options Section -->
            <div class="pipeline-section">
              <div class="section-header">Path Options</div>

              <div class="control-group">
                <label class="control-label">Fill</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="fillToggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div id="strokeControls">
                <div class="control-group">
                  <label class="control-label">Stroke Color</label>
                  <input type="color" class="control-color" id="strokeColorPicker" value="#000000">
                </div>

                <div class="control-group">
                  <label class="control-label">Stroke Width</label>
                  <div class="control-slider-wrapper">
                    <button class="arrow-btn" data-target="strokeWidthSlider" data-direction="-1">◄</button>
                    <input type="range" class="control-slider" id="strokeWidthSlider" min="0.1" max="10" step="0.1" value="1">
                    <button class="arrow-btn" data-target="strokeWidthSlider" data-direction="1">►</button>
                  </div>
                  <span class="control-value" id="strokeWidthValue">1.0</span>
                </div>
              </div>
            </div>

            <!-- Display Options Section -->
            <div class="pipeline-section">
              <div class="section-header">Display</div>

              <div class="control-group">
                <label class="control-label">Show Bitmap</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="showBitmapToggle" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <!-- Action Buttons -->
            <button class="trace-action-btn" id="traceActionBtn">Trace</button>
            <button class="trace-action-btn capture-btn" id="captureTraceBtn" disabled>Capture Trace</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scope Tab -->
    <div class="tab-content active" id="scopeTab">
      <div class="container">
        <!-- Left Panel: Tree Structure -->
        <div class="left-panel">
          <div class="panel-header">SVG Structure</div>
          <div class="layers-list" id="layersList">
            <div style="padding: 16px; text-align: center; opacity: 0.5; font-size: 13px;">
              No file loaded
            </div>
          </div>
        </div>

        <!-- Center: Canvas -->
        <div class="canvas-area">
          <!-- Fixed Toolbar -->
          <div class="canvas-toolbar" id="canvasToolbar">
            <!-- Edit Controls -->
            <div class="toolbar-group">
              <button class="svg-control-btn" id="cropBtn" title="Crop" style="width: auto; padding: 0 12px; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M 2 5 L 5 5 L 5 2 M 11 2 L 11 5 L 14 5 M 14 11 L 11 11 L 11 14 M 5 14 L 5 11 L 2 11" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
                <span style="font-size: 13px;">Crop</span>
              </button>
              <div class="toolbar-divider"></div>
              <button class="svg-control-btn" id="flipHorizontal" title="Flip Horizontal" style="font-size: 18px;">↔️</button>
              <button class="svg-control-btn" id="flipVertical" title="Flip Vertical" style="font-size: 18px;">↕️</button>
            </div>

            <!-- View Controls -->
            <div class="toolbar-group">
              <button class="svg-control-btn active" id="fitViewport" title="Fit to Viewport">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 5 5 L 8 8 L 11 5" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 5 11 L 8 8 L 11 11" fill="none" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
              <button class="svg-control-btn" id="fullSize" title="Full Size">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <rect x="2" y="2" width="12" height="12" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 2 2 L 5 5 M 14 2 L 11 5 M 2 14 L 5 11 M 14 14 L 11 11" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
            </div>

            <!-- Zoom Controls -->
            <div class="toolbar-group">
              <button class="svg-control-btn" id="zoomOut" title="Zoom Out">−</button>
              <div class="zoom-level" id="zoomLevel">100%</div>
              <button class="svg-control-btn" id="zoomIn" title="Zoom In">+</button>
              <button class="svg-control-btn" id="zoomReset" title="Reset Zoom">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <circle cx="8" cy="8" r="6" fill="none" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M 6 8 L 10 8 M 8 6 L 8 10" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="canvas-content" id="canvasContent">
            <div class="upload-zone">
              <input type="file" id="fileInput" accept=".svg" />
              <button class="upload-btn" id="uploadBtn">
                Upload SVG File
              </button>
              <div class="upload-text">
                or drag and drop an SVG file here
              </div>
            </div>
          </div>
          
          <!-- Bottom Info Bar -->
          <div class="canvas-info-bar" id="canvasInfoBar">
            <div class="info-bar-item">
              <span class="info-bar-label">Element:</span>
              <span class="info-bar-value" id="infoBarElement">—</span>
            </div>
            <div class="info-bar-divider"></div>
            <div class="info-bar-item">
              <span class="info-bar-label">X:</span>
              <span class="info-bar-value" id="infoBarX">—</span>
            </div>
            <div class="info-bar-item">
              <span class="info-bar-label">Y:</span>
              <span class="info-bar-value" id="infoBarY">—</span>
            </div>
            <div class="info-bar-divider"></div>
            <div class="info-bar-item">
              <span class="info-bar-label">Width:</span>
              <span class="info-bar-value" id="infoBarWidth">—</span>
            </div>
            <div class="info-bar-item">
              <span class="info-bar-label">Height:</span>
              <span class="info-bar-value" id="infoBarHeight">—</span>
            </div>
            <div class="info-bar-divider"></div>
            <div class="info-bar-item">
              <span class="info-bar-label">Children:</span>
              <span class="info-bar-value" id="infoBarChildren">—</span>
            </div>
          </div>
        </div>

        <!-- Right Panel: Info -->
        <div class="right-panel">
          <div class="panel-header">Element Properties</div>
          <div class="info-content" id="infoContent">
            <div style="padding: 16px; text-align: center; opacity: 0.5; font-size: 13px;">
              Select an element to view properties
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="potrace.js"></script>
  <script src="renderer.js"></script>
</body>
</html>